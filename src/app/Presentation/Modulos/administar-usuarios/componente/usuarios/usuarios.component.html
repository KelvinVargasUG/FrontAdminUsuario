<title>Lista de Usuarios</title>
<br>
<h2 class="text-white text-center">Lista de Usuarios</h2>

<div class="container">
    <button
            type="button"
            class="btn btn-success"
            data-bs-toggle="modal"
            data-bs-target="#fromUsuario"
    >
        <i class="bi bi-file-earmark-text"></i>
        Crear Usuario
    </button>

    <br>
    <table class="table table-dark table-hover">
        <thead class="table-primary">
        <tr>
            <th>Id</th>
            <th>Nombre</th>
            <th>Email</th>
            <th>Estado</th>
            <th>Rol</th>
            <th>Acciones</th>
        </tr>
        </thead>

        <tbody >
        <tr *ngFor="let usuario of usuariosList">
            <td>{{usuario.id}}</td>
            <td>{{usuario.nombre}} {{usuario.apellido}}</td>
            <td>{{usuario.email}}</td>
            <td>{{(usuario.estado | uppercase) == "A" ? "Activo" : "Inactivo"}}</td>
            <td>{{usuario.rolList | rolListFormatHuman}} </td>
            <td>
                <button
                        class="btn btn-danger" (click)="deleteUser(usuario.id)"
                >
                    <i class="bi bi-trash3"></i>
                    Eliminar
                </button>
                <button
                        class="btn btn-warning text-white"
                        [routerLink]="[EditarUsuarioComponent.ROUTE, usuario.id]"
                >
                    <i class="bi bi-pencil-square"></i>
                    Editar
                </button>
                <button
                        class="btn btn-info text-white"
                        data-bs-toggle="modal"
                        data-bs-target="#fromQuitarRol"
                        (click)="respaldarUser(usuario)"
                >
                    <i class="bi bi-person-x-fill"></i>
                    Quitar Rol
                </button>
            </td>
        </tr>

        </tbody>
    </table>
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="btn btn-dark"><i class="bi bi-chevron-double-left text-white"></i></a>
            </li>
            <li class="page-item"><a class="btn btn-dark text-white">1</a></li>
            <li class="page-item">
                <a class="btn btn-dark"><i class="bi bi-chevron-double-right text-white"></i></a>
            </li>
        </ul>
    </nav>
</div>


<!-- Modal Quitar rol -->
<form class="needs-validation">
    <div
            class="modal fade"
            id="fromQuitarRol"
            data-bs-backdrop="static"
            data-bs-keyboard="false"
            tabindex="-1"
            aria-labelledby="staticBackdropLabel"
            aria-hidden="true"
    >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #523961">
                    <h5 class="modal-title text-light">Quitar Rol</h5>
                </div>

                <div class="modal-body" style="background-color: #c3bbc9">
                    <div class="form-row">
                        <div *ngFor="let rol of usuarioRespaldo?.rolList">
                            <button
                                    type="submit"
                                    data-bs-dismiss="modal"
                                    class="btn btn-outline-danger"
                                   [disabled]="usuarioRespaldo && usuarioRespaldo.rolList.length === 1"
                                    (click)="deleteRolUser(rol.id)"
                            >
                                Eliminar {{ rol | rolFormatHuman}}
                            </button>
                            <br/>
                            <div *ngIf="usuarioRespaldo && usuarioRespaldo.rolList.length === 1">
                                <h6> Cada usuario debe tener al menos un rol agrege otro rol para poder eliminar un
                                    rol.</h6>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Cerrar
                </button>
            </div>
        </div>
    </div>
</form>


<!--Modal Crear Usuario-->
<form
        [formGroup]="formUser"
        (ngSubmit)="saveUser()"
        class="needs-validation"
>
    <div
            class="modal fade"
            id="fromUsuario"
            data-bs-backdrop="static"
            data-bs-keyboard="false"
            tabindex="-1"
            aria-labelledby="staticBackdropLabel"
            aria-hidden="true"
    >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #523961">
                    <h5 class="modal-title text-light">Crear Usuario</h5>
                </div>
                <div class="modal-body" style="background-color: #c3bbc9">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre</label>
                            <input
                                    required
                                    formControlName="nombre"
                                    type="text"
                                    class="form-control"
                                    placeholder="Ingrese Nombre"
                            />
                        </div>

                        <div class="form-group">
                            <label>Apellido</label>
                            <input
                                    formControlName="apellido"
                                    type="text"
                                    class="form-control"
                                    placeholder="Ingrese Apellido"
                            />
                        </div>

                        <div class="form-group">
                            <label>Email</label>
                            <input
                                    formControlName="email"
                                    type="email"
                                    class="form-control"
                                    aria-describedby="emailHelp"
                                    placeholder="Ingrese Email"
                            />
                        </div>

                        <div class="form-group">
                            <label>contrase√±a</label>
                            <input
                                    formControlName="password"
                                    type="password"
                                    class="form-control"
                                    placeholder="Ingrese password"
                            />
                        </div>

                        <div class="form-group">
                            <label>Estado</label>
                            <select formControlName="estado" class="form-control">
                                <option value="" selected>Seleccione Estado</option>
                                <option value="A">Activo</option>
                                <option value="I">Inactivo</option>
                            </select>
                        </div>

                        <div class="form-group" formArrayName="rol">
                            <div formGroupName="0">
                            <label>Rol</label>
                            <select formControlName="id" class="form-control" required>
                                <option value="" selected>Seleccione Rol</option>
                                <option *ngFor="let rol of roles" [value]="rol.id">{{rol | rolFormatHuman}}</option>
                            </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="background-color: #c3bbc9">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                        <i class="bi bi-caret-left-fill"></i> Cerrar
                    </button>

                    <button
                            type="submit"
                            data-bs-dismiss="modal"
                            [disabled]="formUser.invalid"
                            class="btn btn-success"
                    >
                        <i class="bi bi-upload"></i> Guardar
                    </button>

                </div>
            </div>
        </div>
    </div>
</form>
